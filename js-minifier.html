<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JavaScript Code Minifier</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }
    
    body {
      background-color: #f5f5f5;
      color: #333;
      line-height: 1.6;
      padding: 20px;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }
    
    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #2c3e50;
    }
    
    .options {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    .language-select {
      flex: 1;
      min-width: 200px;
    }
    
    select, button {
      padding: 10px;
      border-radius: 4px;
      border: 1px solid #ddd;
      background-color: #fff;
      font-size: 16px;
      width: 100%;
    }
    
    button {
      background-color: #3498db;
      color: white;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    
    button:hover {
      background-color: #2980b9;
    }
    
    button:disabled {
      background-color: #95a5a6;
      cursor: not-allowed;
    }
    
    .action-button {
      flex: 1;
      min-width: 150px;
    }
    
    .editor-container {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .editor-box {
      flex: 1;
      min-width: 300px;
      display: flex;
      flex-direction: column;
    }
    
    .editor-box h3 {
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .editor {
      height: 400px;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      font-family: monospace;
      overflow: auto;
      width: 100%;
      resize: vertical;
      white-space: pre-wrap;
      font-size: 14px;
      line-height: 1.5;
      background-color: #f8f8f8;
    }
    
    .drop-zone {
      border: 2px dashed #3498db;
      border-radius: 4px;
      padding: 20px;
      text-align: center;
      margin-bottom: 20px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .drop-zone:hover, .drop-zone.active {
      background-color: #ecf0f1;
    }
    
    .drop-zone p {
      margin: 5px 0;
    }
    
    .hidden {
      display: none;
    }
    
    .stats {
      background-color: #f8f8f8;
      padding: 15px;
      border-radius: 4px;
      margin-top: 20px;
    }
    
    .stats h3 {
      margin-bottom: 10px;
    }
    
    .copy-button {
      background-color: #2ecc71;
      padding: 5px 10px;
      font-size: 14px;
    }
    
    .copy-button:hover {
      background-color: #27ae60;
    }
    
    .copy-success {
      background-color: #27ae60;
    }
    
    @media (max-width: 768px) {
      .editor-container {
        flex-direction: column;
      }
      
      .options {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>JavaScript Code Minifier</h1>
    
    <div class="drop-zone" id="dropZone">
      <p>Drag and drop a file here</p>
      <p>or</p>
      <p><button id="selectFileButton">Select a file</button></p>
      <input type="file" id="fileInput" class="hidden" accept=".js,.css,.html,.txt">
    </div>
    
    <div class="options">
      <div class="language-select">
        <select id="languageSelect">
          <option value="javascript">JavaScript</option>
          <option value="css">CSS</option>
          <option value="html">HTML</option>
        </select>
      </div>
      <div class="action-button">
        <button id="minifyButton">Minify Code</button>
      </div>
    </div>
    
    <div class="editor-container">
      <div class="editor-box">
        <h3>Original Code</h3>
        <textarea id="originalCode" class="editor" placeholder="Paste your code here..."></textarea>
      </div>
      <div class="editor-box">
        <h3>
          Minified Code
          <button id="copyButton" class="copy-button" disabled>Copy</button>
        </h3>
        <textarea id="minifiedCode" class="editor" readonly></textarea>
      </div>
    </div>
    
    <div class="stats" id="stats"></div>
  </div>

  <script>
    // Minifier Library
    const CodeMinifier = (function() {
      // JavaScript minification
      function minifyJS(code) {
        if (!code || typeof code !== 'string') return '';
        
        try {
          // Remove comments (both single-line and multi-line)
          let minified = code.replace(/\/\/.*$/gm, '')
                            .replace(/\/\*[\s\S]*?\*\//g, '')
                            .replace(/^\s*\n/gm, '');
          
          // Remove unnecessary whitespace
          minified = minified.replace(/\s+/g, ' ');
          
          // Remove whitespace around operators and brackets
          minified = minified.replace(/\s*([{}:;,=+\-*/<>()&|!])\s*/g, '$1');
          
          // Fix spacing issues caused by previous replacements
          minified = minified.replace(/}else/g, '} else');
          minified = minified.replace(/else{/g, 'else {');
          minified = minified.replace(/if\(/g, 'if (');
          minified = minified.replace(/for\(/g, 'for (');
          minified = minified.replace(/while\(/g, 'while (');
          minified = minified.replace(/function\(/g, 'function(');
          
          // Restore necessary spaces
          minified = minified.replace(/([+\-*/<>])\(/g, '$1 (');
          minified = minified.replace(/return\(/g, 'return (');
          
          // Handle special cases
          minified = minified.replace(/\s*;\s*/g, ';');
          
          // Final cleanup
          minified = minified.trim();
          
          return minified;
        } catch (error) {
          console.error('Error in JS minification:', error);
          return code; // Return original code on error
        }
      }
      
      // CSS minification
      function minifyCSS(code) {
        if (!code || typeof code !== 'string') return '';
        
        try {
          // Remove comments
          let minified = code.replace(/\/\*[\s\S]*?\*\//g, '');
          
          // Remove whitespace around brackets, colons, semicolons
          minified = minified.replace(/\s*([{}:;,])\s*/g, '$1');
          
          // Replace multiple whitespaces with single space
          minified = minified.replace(/\s+/g, ' ');
          
          // Remove spaces after and before brackets
          minified = minified.replace(/\s*{\s*/g, '{');
          minified = minified.replace(/\s*}\s*/g, '}');
          
          // Remove semicolons before closing bracket
          minified = minified.replace(/;\}/g, '}');
          
          // Remove leading and trailing whitespace
          minified = minified.trim();
          
          return minified;
        } catch (error) {
          console.error('Error in CSS minification:', error);
          return code; // Return original code on error
        }
      }
      
      // HTML minification
      function minifyHTML(code) {
        if (!code || typeof code !== 'string') return '';
        
        try {
          // Remove comments (except conditional comments for IE)
          let minified = code.replace(/<!--(?!\[if\s)[\s\S]*?-->/g, '');
          
          // Remove whitespace between tags
          minified = minified.replace(/>\s+</g, '><');
          
          // Remove leading and trailing whitespace in elements
          minified = minified.replace(/\s+>/g, '>');
          minified = minified.replace(/<\s+/g, '<');
          
          // Remove unnecessary whitespace
          minified = minified.replace(/\s{2,}/g, ' ');
          
          // Remove whitespace around attributes
          minified = minified.replace(/\s*=\s*/g, '=');
          
          // Preserve script and style tags content
          const preserveTags = (html, tagName) => {
            const regex = new RegExp(`<${tagName}[^>]*>([\\s\\S]*?)<\\/${tagName}>`, 'gi');
            return html.replace(regex, (match, content) => {
              // Replace the content with a placeholder
              const placeholder = `###${tagName}-${Math.random().toString(36).substring(2, 15)}###`;
              window[placeholder] = content;
              return `<${tagName}>${placeholder}</${tagName}>`;
            });
          };
          
          // Restore script and style tags content
          const restoreTags = (html, tagName) => {
            const regex = new RegExp(`<${tagName}>###${tagName}-([a-z0-9]+)###<\\/${tagName}>`, 'gi');
            return html.replace(regex, (match, id) => {
              const placeholder = `###${tagName}-${id}###`;
              const content = window[placeholder];
              delete window[placeholder];
              return `<${tagName}>${content}</${tagName}>`;
            });
          };
          
          // Preserve and restore script and style content
          minified = preserveTags(minified, 'script');
          minified = preserveTags(minified, 'style');
          minified = restoreTags(minified, 'script');
          minified = restoreTags(minified, 'style');
          
          // Final cleanup
          minified = minified.trim();
          
          return minified;
        } catch (error) {
          console.error('Error in HTML minification:', error);
          return code; // Return original code on error
        }
      }
      
      // Public API
      return {
        minify: function(code, language) {
          switch (language.toLowerCase()) {
            case 'javascript':
            case 'js':
              return minifyJS(code);
            case 'css':
              return minifyCSS(code);
            case 'html':
              return minifyHTML(code);
            default:
              // Basic minification for unknown types
              return code.replace(/\s+/g, ' ').trim();
          }
        },
        
        calculateStats: function(original, minified) {
          if (!original || !minified) {
            return {
              originalSize: 0,
              minifiedSize: 0,
              reduction: 0,
              compressionRatio: 0
            };
          }
          
          const originalSize = new Blob([original]).size;
          const minifiedSize = new Blob([minified]).size;
          const reduction = originalSize > 0 ? ((originalSize - minifiedSize) / originalSize * 100) : 0;
          const compressionRatio = originalSize > 0 ? (originalSize / minifiedSize).toFixed(2) : 0;
          
          return {
            originalSize,
            minifiedSize,
            reduction,
            compressionRatio
          };
        }
      };
    })();

    // UI Controller
    const UIController = (function() {
      // DOM elements
      const elements = {
        dropZone: document.getElementById('dropZone'),
        fileInput: document.getElementById('fileInput'),
        selectFileButton: document.getElementById('selectFileButton'),
        originalCode: document.getElementById('originalCode'),
        minifiedCode: document.getElementById('minifiedCode'),
        languageSelect: document.getElementById('languageSelect'),
        minifyButton: document.getElementById('minifyButton'),
        copyButton: document.getElementById('copyButton'),
        stats: document.getElementById('stats')
      };
      
      // Setup event listeners
      function setupEventListeners() {
        // File drag and drop
        elements.dropZone.addEventListener('dragover', (e) => {
          e.preventDefault();
          e.stopPropagation();
          elements.dropZone.classList.add('active');
        });
        
        elements.dropZone.addEventListener('dragleave', (e) => {
          e.preventDefault();
          e.stopPropagation();
          elements.dropZone.classList.remove('active');
        });
        
        elements.dropZone.addEventListener('drop', (e) => {
          e.preventDefault();
          e.stopPropagation();
          elements.dropZone.classList.remove('active');
          
          const files = e.dataTransfer.files;
          if (files.length > 0) {
            handleFile(files[0]);
          }
        });
        
        // File selection
        elements.selectFileButton.addEventListener('click', () => {
          elements.fileInput.click();
        });
        
        elements.fileInput.addEventListener('change', (e) => {
          if (e.target.files.length > 0) {
            handleFile(e.target.files[0]);
          }
        });
        
        // Minify button
        elements.minifyButton.addEventListener('click', () => {
          processMinification();
        });
        
        // Copy button
        elements.copyButton.addEventListener('click', () => {
          copyToClipboard();
        });
        
        // Auto-detect language from file extension
        elements.originalCode.addEventListener('input', () => {
          updateUI();
        });
      }
      
      // Handle file upload
      function handleFile(file) {
        const reader = new FileReader();
        
        reader.onload = (event) => {
          elements.originalCode.value = event.target.result;
          
          // Auto-detect language from file extension
          const fileName = file.name.toLowerCase();
          if (fileName.endsWith('.js')) {
            elements.languageSelect.value = 'javascript';
          } else if (fileName.endsWith('.css')) {
            elements.languageSelect.value = 'css';
          } else if (fileName.endsWith('.html') || fileName.endsWith('.htm')) {
            elements.languageSelect.value = 'html';
          }
          
          updateUI();
        };
        
        reader.readAsText(file);
      }
      
      // Process minification
      function processMinification() {
        const code = elements.originalCode.value;
        const language = elements.languageSelect.value;
        
        if (!code.trim()) {
          alert('Please enter or upload code first');
          return;
        }
        
        try {
          const minified = CodeMinifier.minify(code, language);
          elements.minifiedCode.value = minified;
          
          // Update stats
          updateStats(code, minified);
          
          // Enable copy button
          elements.copyButton.disabled = false;
        } catch (error) {
          console.error('Minification error:', error);
          alert('Error during minification. Please check the console for details.');
        }
      }
      
      // Update stats display
      function updateStats(original, minified) {
        const stats = CodeMinifier.calculateStats(original, minified);
        
        const originalKB = (stats.originalSize / 1024).toFixed(2);
        const minifiedKB = (stats.minifiedSize / 1024).toFixed(2);
        const reduction = stats.reduction.toFixed(2);
        
        elements.stats.innerHTML = `
          <h3>Statistics</h3>
          <p>Original size: ${originalKB} KB (${stats.originalSize.toLocaleString()} bytes)</p>
          <p>Minified size: ${minifiedKB} KB (${stats.minifiedSize.toLocaleString()} bytes)</p>
          <p>Reduction: ${reduction}%</p>
          <p>Compression ratio: ${stats.compressionRatio}:1</p>
        `;
      }
      
      // Copy to clipboard
      function copyToClipboard() {
        const minifiedCode = elements.minifiedCode.value;
        
        if (!minifiedCode) {
          return;
        }
        
        navigator.clipboard.writeText(minifiedCode).then(() => {
          const originalText = elements.copyButton.textContent;
          elements.copyButton.textContent = 'Copied!';
          elements.copyButton.classList.add('copy-success');
          
          setTimeout(() => {
            elements.copyButton.textContent = originalText;
            elements.copyButton.classList.remove('copy-success');
          }, 2000);
        }).catch(err => {
          console.error('Could not copy text: ', err);
          alert('Failed to copy to clipboard');
        });
      }
      
      // Update UI based on current state
      function updateUI() {
        if (elements.originalCode.value.trim()) {
          elements.minifyButton.disabled = false;
        } else {
          elements.minifyButton.disabled = true;
        }
      }
      
      // Public API
      return {
        init: function() {
          setupEventListeners();
          updateUI();
          console.log('Minifier initialized');
        }
      };
    })();

    // Initialize the application
    document.addEventListener('DOMContentLoaded', function() {
      UIController.init();
    });
  </script>
</body>
</html>
