javascript:(function(){const k={},s={default:"position:fixed;top:20px;right:20px;padding:15px;border-radius:5px;box-shadow:0 0 10px rgba(0,0,0,0.3);z-index:10000;width:300px;font-family:Arial,sans-serif;",fullHeight:"position:absolute;top:0;right:0;padding:15px;box-shadow:0 0 10px rgba(0,0,0,0.3);z-index:10000;width:300px;font-family:Arial,sans-serif;height:100vh;margin:0;"},t={light:{bg:"white",text:"#000",border:"#ccc"},dark:{bg:"#222",text:"#fff",border:"#444"}};let d=null,c="default",m="light";const D=!0,a=()=>{if(!document.getElementById("kb-theme-styles")){const e=document.createElement("style");e.id="kb-theme-styles",e.textContent=".kb-light-theme{background-color:white!important;color:#000!important}.kb-light-theme select{background-color:white!important;color:#000!important;border-color:#ccc!important}.kb-dark-theme{background-color:#222!important;color:#fff!important}.kb-dark-theme select{background-color:#222!important;color:#fff!important;border-color:#444!important}#inject-btn{background-color:#49A74C!important;color:white!important}#copy-btn{background-color:#0B78D0!important;color:white!important}#close-btn,#style-toggle,#theme-toggle{background-color:transparent!important}",document.head.appendChild(e)}},l=(e,t)=>{D&&(t==="error"?console.error(`[LLM Primer] ${e}`:console.log(`[LLM Primer] ${e}`))},L=(e,t,n)=>{l(`Attempting to load: ${e}`);const S=document.getElementById("load-status");S&&(S.textContent=`Loading: ${e}`,S.style.color="orange");const T=document.createElement("script");T.src=e;const O=setTimeout(()=>{l(`Script load timeout, trying alternative method: ${e}`,"error"),F(e,t,n)},3e3);T.onload=()=>{clearTimeout(O),l(`Script loaded successfully: ${e}`),S&&(S.textContent=`Loaded: ${e}`,S.style.color="green"),setTimeout(()=>t(),100)},T.onerror=e=>{clearTimeout(O),l(`Error loading script via standard method: ${e}`,"error"),S&&(S.textContent="Standard load failed, trying fetch method...",S.style.color="red"),F(e,t,n)},document.head.appendChild(T)},F=async(e,t,n)=>{l(`Attempting fetch method for: ${e}`);const S=document.getElementById("load-status");S&&(S.textContent=`Trying fetch method: ${e}`,S.style.color="orange");try{const r=await fetch(e);if(!r.ok)throw new Error(`Network response was not ok: ${r.status}`);const s=await r.text();l("Script fetched, evaluating content...");try{new Function(s)(),l("Script evaluated successfully"),S&&(S.textContent=`Script loaded via fetch: ${e}`,S.style.color="green"),setTimeout(()=>t(),100)}catch(e){l(`Error evaluating script: ${e.message}`,"error"),S&&(S.textContent=`Error evaluating script: ${e.message}`,S.style.color="red"),n(`Failed to evaluate the loaded script. Error: ${e.message}`)}}catch(e){l(`Fetch error: ${e.message}`,"error"),S&&(S.textContent=`Failed to load script: ${e.message}`,S.style.color="red"),n("Failed to load script. The server might be down or the site may be blocking external requests.")}},M=(e,t)=>{L("https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.0/mammoth.browser.min.js",e,t)},K=(e,t)=>{L("llmPrimer_bkm_kbLoader_v1.0.js",e,t)},P=e=>{const S=document.getElementById("load-status");S&&(S.textContent=e,S.style.color="red"),document.getElementById("inject-btn").disabled=!0,document.getElementById("copy-btn").disabled=!0;const C=document.getElementById("category-select"),B=document.getElementById("kb-select");C.innerHTML='<option value="">Error loading data</option>',C.disabled=!0,B.innerHTML='<option value="">Error loading data</option>',B.disabled=!0,alert(`Loading Error: ${e}\n\nPlease try again or check if the website allows loading external scripts.`)},U=()=>{const e=document.getElementById("category-select");e.innerHTML="";if(!window.kbLoader?.categories){l("Error: kbLoader or kbLoader.categories is undefined","error"),e.innerHTML='<option value="">Error loading categories</option>',e.disabled=!0;return}const o=document.createElement("option");o.value="",o.textContent="Select a category...",e.appendChild(o);for(const c of window.kbLoader.categories){const n=document.createElement("option");n.value=c.id,n.textContent=c.title,e.appendChild(n)}e.disabled=!1;if(window.kbLoader.categories.length>0){e.value=window.kbLoader.categories[0].id,V(e.value)}},V=e=>{const b=document.getElementById("kb-select");b.innerHTML="";if(!window.kbLoader?.domains){l("Error: kbLoader or kbLoader.domains is undefined","error"),b.innerHTML='<option value="">Error loading knowledge bases</option>',b.disabled=!0;return}if(!e){b.innerHTML='<option value="">Select a category first</option>',b.disabled=!0,document.getElementById("inject-btn").disabled=!0,document.getElementById("copy-btn").disabled=!0;return}const o=document.createElement("option");o.value="",o.textContent="Select a knowledge base...",b.appendChild(o);const f=window.kbLoader.domains.filter(k=>k.category===e);if(f.length===0){b.innerHTML='<option value="">No knowledge bases for this category</option>',b.disabled=!0,document.getElementById("inject-btn").disabled=!0,document.getElementById("copy-btn").disabled=!0;return}for(const k of f){const n=document.createElement("option");n.value=k.id,n.textContent=k.title,b.appendChild(n)}b.disabled=!1;if(f.length>0){b.value=f[0].id,H()}},H=()=>{const e=document.getElementById("kb-select"),i=e.value;if(!i){document.getElementById("inject-btn").disabled=!0,document.getElementById("copy-btn").disabled=!0,d=null;return}const k=window.kbLoader.domains.find(b=>b.id===i);if(!k){l(`Error: Knowledge base with ID ${i} not found`,"error"),document.getElementById("inject-btn").disabled=!0,document.getElementById("copy-btn").disabled=!0,d=null;return}d=k.docxUrl,document.getElementById("inject-btn").disabled=!1,document.getElementById("copy-btn").disabled=!1},G=async e=>{l(`Fetching DOCX from: ${e}`);const S=document.getElementById("load-status");S&&(S.textContent=`Fetching document: ${e}`,S.style.color="orange");try{const r=await fetch(e);if(!r.ok)throw new Error(`Network response was not ok: ${r.status}`);const a=await r.arrayBuffer();l("DOCX fetched, parsing content..."),S&&(S.textContent="Parsing document content...",S.style.color="orange");if(!window.mammoth)throw new Error("Mammoth.js not loaded. Cannot parse DOCX.");const h=await window.mammoth.convertToHtml({arrayBuffer:a}),m=h.value,w=J(m);return l("DOCX parsed successfully"),S&&(S.textContent="Document parsed successfully",S.style.color="green"),w}catch(r){throw l(`Error fetching or parsing DOCX: ${r.message}`,"error"),S&&(S.textContent=`Error: ${r.message}`,S.style.color="red"),r}},J=e=>{const v=document.createElement("div");v.innerHTML=e;const E=(e,d=0)=>{let m="";if(e.nodeType===3)return e.textContent;if(e.nodeType!==1)return"";const g=e.tagName.toLowerCase();switch(g){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":const l=parseInt(g.charAt(1));m+=`${"#".repeat(l)} ${e.textContent.trim()}\n\n`;break;case"p":for(const c of e.childNodes)m+=E(c,d);m+="\n\n";break;case"ul":for(const l of e.querySelectorAll("li"))m+=`- ${l.textContent.trim()}\n`;m+="\n";break;case"ol":let i=1;for(const l of e.querySelectorAll("li"))m+=`${i}. ${l.textContent.trim()}\n`,i++;m+="\n";break;case"a":const h=e.getAttribute("href");m+=`[${e.textContent}](${h})`;break;case"strong":case"b":m+=`**${e.textContent}**`;break;case"em":case"i":m+=`*${e.textContent}*`;break;case"code":m+=`\`${e.textContent}\``;break;case"pre":m+=`\`\`\`\n${e.textContent}\n\`\`\`\n\n`;break;case"blockquote":for(const c of e.childNodes){const t=E(c,d+1);m+=t.split("\n").map(l=>`> ${l}`).join("\n")}m+="\n\n";break;case"br":m+="\n";break;case"hr":m+=`---\n\n`;break;case"img":const r=e.getAttribute("src"),a=e.getAttribute("alt")||"";m+=`![${a}](${r})`;break;case"table":const s=e.querySelectorAll("tr");for(let n=0;n<s.length;n++){const c=s[n].querySelectorAll("td, th"),w=[];for(const e of c)w.push(e.textContent.trim());m+=`| ${w.join(" | ")} |\n`;if(n===0)m+=`|${w.map(()=>" --- ").join("|")}|\n`}m+="\n";break;default:for(const c of e.childNodes)m+=E(c,d)}return m};return E(v).trim()},I=e=>{const t=document.querySelector("div#prompt-textarea p.placeholder");if(!t){alert("Target placeholder not found!");return}t.innerText=e,t.dispatchEvent(new Event("input",{bubbles:!0})),setTimeout(()=>{const e=document.querySelector('button[data-testid="send-button"]');e?(e.click(),R()):alert("Send button not found!")},100)},Q=async e=>{try{await navigator.clipboard.writeText(e);const b=document.getElementById("copy-btn"),t=b.innerText;b.innerText="Copied!",b.style.backgroundColor="#4CAF50",setTimeout(()=>{b.innerText=t,b.style.backgroundColor="#0B78D0"},1500)}catch(r){alert(`Copy failed: ${r}`)}},X=async()=>{if(!d){alert("Please select a knowledge base first!");return}try{const m=await G(d);I(m)}catch(e){alert(`Failed to process document: ${e.message}`)}},Y=async()=>{if(!d){alert("Please select a knowledge base first!");return}try{const m=await G(d);Q(m)}catch(e){alert(`Failed to process document: ${e.message}`)}},R=()=>{document.body.removeChild(p),document.removeEventListener("keydown",Z)},Z=e=>{e.key==="Escape"&&R()},W=()=>{const S=document.getElementById("load-status");S&&(S.textContent="Loading required scripts...",S.style.color="orange"),M(()=>{l("Mammoth.js loaded successfully"),K(()=>{l("KB Loader script loaded successfully"),S&&(S.textContent="All scripts loaded successfully",S.style.color="green"),U()},e=>P(`Failed to load KB Loader script: ${e}`))},e=>P(`Failed to load Mammoth.js: ${e}`))},p=document.createElement("div");a(),p.id="llm-primer-panel",p.style.cssText=s.default,p.className="kb-light-theme",p.innerHTML='<h2 style="color:#147CBD;margin:28px 0 10px 0;font-size:1.2em">LLM Primer</h2><div style="display:flex;justify-content:end;position:absolute;top:12px;float:right;right:30px;"><button id="style-toggle" style="margin:0px 3px;background-color:transparent;border-radius:3px;padding:3px;cursor:pointer" title="Toggle Panel Style" aria-label="Toggle Panel Style"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line></svg></button><button id="theme-toggle" style="background-color:transparent;border-radius:3px;padding:3px;cursor:pointer" title="Toggle Theme" aria-label="Toggle Theme"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></button></div><div id="load-status" style="margin-bottom:10px;padding:5px;background:#f0f0f0;border-radius:3px;font-size:12px;color:orange;">Ready to load data...</div><label style="display:block;margin-bottom:5px;font-size:14px">Select Category:</label><select id="category-select" style="width:100%;padding:5px;margin-bottom:15px;border-radius:3px;border:1px solid #ccc" disabled><option value="">Loading categories...</option></select><label style="display:block;margin-bottom:5px;font-size:14px">Select Knowledge Base:</label><select id="kb-select" style="width:100%;padding:5px;margin-bottom:15px;border-radius:3px;border:1px solid #ccc" disabled><option value="">Select a category first</option></select><div style="display:flex;gap:10px;margin-bottom:10px"><button id="inject-btn" style="flex:1;padding:8px;background:#49A74C;color:white;border:none;border-radius:3px;cursor:pointer;font-weight:bold" disabled>Inject Prompt</button><button id="copy-btn" style="flex:1;padding:8px;background:#0B78D0;color:white;border:none;border-radius:3px;cursor:pointer;font-weight:bold" disabled>Copy Prompt</button></div><button id="close-btn" aria-label="close prompt generator" style="position:absolute;top:10px;right:10px;background-color:transparent;border:none;cursor:pointer;font-size:16px;font-weight:bold">âœ•</button>',document.body.appendChild(p),document.getElementById("close-btn").addEventListener("click",R),document.getElementById("inject-btn").addEventListener("click",X),document.getElementById("copy-btn").addEventListener("click",Y),document.getElementById("category-select").addEventListener("change",e=>{V(e.target.value)}),document.getElementById("kb-select").addEventListener("change",H),document.addEventListener("keydown",Z),document.getElementById("style-toggle").addEventListener("click",function(){if(c==="default"){c="fullHeight",this.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="9" y1="3" x2="9" y2="21"></line></svg>',this.title="Switch to Floating Panel"}else{c="default",this.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line></svg>',this.title="Switch to Full Height Sidebar"}const t=p.className;p.style.cssText=s[c],p.className=t}),document.getElementById("theme-toggle").addEventListener("click",function(){if(m==="light"){m="dark",this.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>',this.title="Switch to Light Theme",p.className="kb-dark-theme"}else{m="light",this.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>',this.title="Switch to Dark Theme",p.className="kb-light-theme"}}),W()})();