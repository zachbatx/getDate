javascript:(function(){if(document.getElementById("llmPrimer-panel")){const e=document.getElementById("llmPrimer-panel");return void(e.style.display="none"===e.style.display?"block":"none")}function e(){return new Promise((e,t)=>{const n=setTimeout(()=>{"undefined"!=typeof kbCategory&&"undefined"!=typeof kbDomain?"undefined"!=typeof mammoth&&"undefined"!=typeof TurndownService?(console.log("Dependencies appear to be available despite timeout"),e()):t(new Error("Libraries failed to load within timeout period")):t(new Error("Knowledge base data failed to load within timeout period"))},1e4),o=()=>{console.log("Injecting fallback KB data"),window.kbCategory=[{id:"designReview",title:"Design Review Tools"},{id:"research",title:"Research Tools"},{id:"accessibility",title:"Accessibility Tools"}],window.kbDomain=[{id:"usabilityHeuristics",title:"Usability Heuristics",docxUrl:"https://your-confluence.domain/path/to/usabilityHeuristics.docx",category:"designReview"},{id:"accessibilityGuidelines",title:"Accessibility Guidelines",docxUrl:"https://your-confluence.domain/path/to/accessibilityGuidelines.docx",category:"accessibility"},{id:"researchMethods",title:"Research Methods",docxUrl:"https://your-confluence.domain/path/to/researchMethods.docx",category:"research"}]};const i=document.createElement("script");i.src="https://path-to-your-script/llmPrimer_bkm_kbLoader_v1.0.js",document.head.appendChild(i),i.onload=()=>{console.log("KB script loaded"),a()},i.onerror=e=>{console.warn("Failed to load KB script:",e),o(),a()};let l="undefined"!=typeof mammoth,r="undefined"!=typeof TurndownService;if(!l){const n=document.createElement("script");n.src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.17/mammoth.browser.min.js",n.integrity="sha512-Qx0Z8xRfpC+q0mEX2S9OMlEJLGwCYMJbsjXnBqZ+0JIFMCdY+zTbWvNGfEDCVDB7YWkbvOVt9wgE3imP33U7Jw==",n.crossOrigin="anonymous",document.head.appendChild(n),n.onload=()=>{console.log("Mammoth loaded"),l=!0,a()},n.onerror=n=>{console.error("Failed to load Mammoth:",n),t(new Error("Failed to load Mammoth.js library"))}}if(!r){const n=document.createElement("script");n.src="https://cdnjs.cloudflare.com/ajax/libs/turndown/7.1.1/turndown.min.js",n.integrity="sha512-OtLX4oNRLqLRxRxB/90jOHCQkPSZQQRLMR0gEXm0krJ8YDvP/cdROjpx4dEkd4GEF5O6+/7C5qYNnU8yHYr/Kw==",n.crossOrigin="anonymous",document.head.appendChild(n),n.onload=()=>{console.log("Turndown loaded"),r=!0,a()},n.onerror=n=>{console.error("Failed to load Turndown:",n),t(new Error("Failed to load Turndown.js library"))}}function a(){console.log("Checking dependencies: Mammoth:",(l||"undefined"!=typeof mammoth),"Turndown:",(r||"undefined"!=typeof TurndownService),"KB data:","undefined"!=typeof kbCategory&&"undefined"!=typeof kbDomain),(l||"undefined"!=typeof mammoth)&&(r||"undefined"!=typeof TurndownService)&&"undefined"!=typeof kbCategory&&"undefined"!=typeof kbDomain&&(console.log("All dependencies loaded successfully"),clearTimeout(n),e())}setTimeout(()=>{a()},2e3)})}function t(){try{const e=document.createElement("div");e.id="llmPrimer-panel",e.style.position="fixed",e.style.top="20px",e.style.right="20px",e.style.width="300px",e.style.backgroundColor="#ffffff",e.style.border="1px solid #cccccc",e.style.borderRadius="5px",e.style.padding="15px",e.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.1)",e.style.zIndex="10000",e.style.fontFamily="Arial, sans-serif",e.style.fontSize="14px",e.style.color="#333333";const t=document.createElement("div");t.style.display="flex",t.style.justifyContent="space-between",t.style.alignItems="center",t.style.marginBottom="15px";const n=document.createElement("h3");n.textContent="llmPrimer",n.style.margin="0",n.style.fontSize="16px",n.style.fontWeight="bold",t.appendChild(n);const l=document.createElement("div");l.style.display="flex",l.style.gap="5px";const a=document.createElement("button");a.id="llmPrimer-theme-btn",a.innerText="ðŸŒ“",a.title="Toggle theme",a.style.border="none",a.style.background="none",a.style.cursor="pointer",a.style.fontSize="16px",a.addEventListener("click",i),l.appendChild(a);const r=document.createElement("button");r.id="llmPrimer-toggle-btn",r.innerText="âš¡",r.title="Toggle panel",r.style.border="none",r.style.background="none",r.style.cursor="pointer",r.style.fontSize="16px",r.addEventListener("click",c),l.appendChild(r);const m=document.createElement("button");m.id="llmPrimer-close-btn",m.innerText="âœ•",m.title="Close panel",m.style.border="none",m.style.background="none",m.style.cursor="pointer",m.style.fontSize="16px",m.addEventListener("click",d),l.appendChild(m),t.appendChild(l),e.appendChild(t);const p=document.createElement("label");p.textContent="Select Category:",p.style.display="block",p.style.marginBottom="5px",p.style.fontSize="14px",e.appendChild(p);const g=document.createElement("select");g.className="categorySelect",g.style.width="100%",g.style.padding="5px",g.style.marginBottom="15px",g.style.borderRadius="3px",g.style.border="1px solid #ccc";const u=document.createElement("option");if(u.value="",u.textContent="-- Select a category --",g.appendChild(u),"undefined"==typeof kbCategory||!Array.isArray(kbCategory))throw new Error("Knowledge base categories not found or invalid");kbCategory.forEach(e=>{const t=document.createElement("option");t.value=e.id,t.textContent=e.title,g.appendChild(t)}),e.appendChild(g);const y=document.createElement("label");y.textContent="Select Knowledge Base:",y.style.display="block",y.style.marginBottom="5px",y.style.fontSize="14px",e.appendChild(y);const h=document.createElement("select");h.className="knowledgeBaseSelect",h.style.width="100%",h.style.padding="5px",h.style.marginBottom="15px",h.style.borderRadius="3px",h.style.border="1px solid #ccc",h.disabled=!0;const f=document.createElement("option");f.value="",f.textContent="-- Select a knowledge base --",h.appendChild(f),e.appendChild(h);const b=document.createElement("div");b.id="llmPrimer-status",b.style.fontSize="13px",b.style.marginBottom="15px",b.style.color="#666",b.style.display="none",e.appendChild(b);const v=document.createElement("div");v.style.display="flex",v.style.justifyContent="space-between",v.style.gap="10px";const w=document.createElement("button");w.id="llmPrimer-inject-btn",w.innerText="Inject Prompt",w.style.padding="8px 15px",w.style.borderRadius="3px",w.style.border="1px solid #ccc",w.style.backgroundColor="#f0f0f0",w.style.cursor="pointer",w.style.flex="1",w.disabled=!0,w.addEventListener("click",s),v.appendChild(w);const E=document.createElement("button");if(E.id="llmPrimer-copy-btn",E.innerText="Copy Prompt",E.style.padding="8px 15px",E.style.borderRadius="3px",E.style.border="1px solid #ccc",E.style.backgroundColor="#f0f0f0",E.style.cursor="pointer",E.style.flex="1",E.disabled=!0,E.addEventListener("click",o),v.appendChild(E),e.appendChild(v),document.body.appendChild(e),g.addEventListener("change",function(){n(this.value),h.disabled=!this.value,w.disabled=!0,E.disabled=!0}),h.addEventListener("change",function(){w.disabled=!this.value,E.disabled=!this.value}),"undefined"==typeof kbDomain||!Array.isArray(kbDomain))throw new Error("Knowledge base domains not found or invalid");kbCategory.length>0&&(g.value=kbCategory[0].id,n(kbCategory[0].id),h.disabled=!1),r()}catch(e){console.error("Error initializing llmPrimer:",e),alert("Failed to initialize llmPrimer: "+e.message)}}function n(e){try{const t=document.querySelector(".knowledgeBaseSelect");if(!t)throw new Error("Knowledge base select element not found");for(;t.options.length>1;)t.remove(1);const n=kbDomain.filter(t=>t.category===e);if(n.forEach(e=>{const n=document.createElement("option");n.value=e.id,n.textContent=e.title,t.appendChild(n)}),n.length>0){t.value=n[0].id;const e=document.getElementById("llmPrimer-inject-btn"),o=document.getElementById("llmPrimer-copy-btn");e&&o&&(e.disabled=!1,o.disabled=!1)}}catch(e){console.error("Error populating knowledge bases:",e),alert("Failed to populate knowledge bases: "+e.message)}}function l(){try{const e=document.querySelector(".knowledgeBaseSelect");if(!e)throw new Error("Knowledge base select element not found");const t=e.value;if(!t)return"";const n=kbDomain.find(e=>e.id===t);return n?n.docxUrl:""}catch(e){return console.error("Error getting DOCX URL:",e),""}}async function a(e){try{if(!e)throw new Error("No valid DOCX URL provided");r("Fetching DOCX file...");let t;try{const n=await fetch(e,{mode:"cors",credentials:"same-origin",headers:{Accept:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}});if(!n.ok)throw new Error(`Direct fetch failed: ${n.status}`);t=await n.arrayBuffer()}catch(n){console.warn("Direct fetch failed, trying alternative method:",n),t=await new Promise((t,n)=>{const o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="arraybuffer",o.onload=function(){this.status>=200&&this.status<300?t(this.response):n(new Error(`XHR failed: ${this.status}`))},o.onerror=function(){n(new Error("Network error occurred"))},o.send()})}r("Converting DOCX to HTML...");const n=await mammoth.convertToHtml({arrayBuffer:t}),o=n.value;r("Converting HTML to Markdown...");const i=new TurndownService;return i.addRule("emphasis",{filter:["em","i"],replacement:function(e){return"*"+e+"*"}}),i.addRule("strong",{filter:["strong","b"],replacement:function(e){return"**"+e+"**"}}),i.turndown(o)}catch(e){throw console.error("Error processing DOCX:",e),r(`Error: ${e.message}`,!0),e}finally{r("Conversion complete!")}}function r(e,t=!1){const n=document.getElementById("llmPrimer-status");n&&(n.textContent=e,n.style.display="block",n.style.color=t?"#dc3545":"#666",!t&&"Conversion complete!"===e&&setTimeout(()=>{n.style.display="none"},5e3))}async function s(){try{const e=l();if(!e)return void alert("No valid DOCX URL found. Please select a knowledge base.");r("Starting conversion process...");let t;try{t=await a(e)}catch(t){return console.error("Conversion error:",t),void alert(`DOCX conversion failed: ${t.message}\n\nThe DOCX file at ${e} could not be accessed or converted. This is likely due to CORS restrictions or an invalid document format.`)}let n=null;const o=["div#prompt-textarea p.placeholder","textarea[placeholder]","[contenteditable='true']","[role='textbox']",".chatbox-input","#message-input"];for(const e of o){const t=document.querySelector(e);if(t){n=t;break}}if(!n)return void alert("Text input area not found! Please ensure you're on a compatible LLM interface.");"TEXTAREA"===n.tagName?(n.value=t,n.dispatchEvent(new Event("input",{bubbles:!0})),n.dispatchEvent(new Event("change",{bubbles:!0}))):n.isContentEditable||"textbox"===n.getAttribute("role")?(n.innerText=t,n.dispatchEvent(new Event("input",{bubbles:!0}))):(n.innerText=t,n.dispatchEvent(new Event("input",{bubbles:!0}))),r("Text inserted successfully!"),setTimeout(()=>{const e=["button[data-testid='send-button']","button.send-button","button[type='submit']","button:has(svg)","button.submit",'[aria-label="Send message"]'];let t=null;for(const n of e){const e=document.querySelector(n);if(e){t=e;break}}t?(t.click(),function(){console.log("Prompt injected successfully")}()):r("Send button not found. Text inserted but not submitted.",!0)},300)}catch(e){console.error("Error injecting prompt:",e),alert("Failed to inject prompt: "+e.message)}}async function o(){try{const e=l();if(!e)return void alert("No knowledge base selected!");r("Starting conversion for copy...");let t;try{t=await a(e)}catch(t){return console.error("Conversion error:",t),void alert(`DOCX conversion failed: ${t.message}\n\nThe DOCX file at ${e} could not be accessed or converted.`)}r("Copying to clipboard...");let n=!1;try{navigator.clipboard&&navigator.clipboard.writeText?(await navigator.clipboard.writeText(t),n=!0):(i=t,(o=document.createElement("textarea")).value=i,o.style.position="fixed",o.style.left="0",o.style.top="0",o.style.opacity="0",o.style.pointerEvents="none",document.body.appendChild(o),o.focus(),o.select(),n=document.execCommand("copy"),document.body.removeChild(o))}catch(e){console.error("Clipboard operation failed:",e);try{const n=document.createElement("textarea");n.value=t,n.style.position="fixed",n.style.top="10px",n.style.left="10px",n.style.width="80%",n.style.height="150px",n.style.zIndex="10001",document.body.appendChild(n),alert("Automatic copy failed. Please manually copy the text from the text area that has appeared on screen."),n.focus(),n.select(),setTimeout(()=>{document.body.contains(n)&&document.body.removeChild(n)},2e4);return}catch(e){console.error("Even fallback textarea failed:",e)}}if(n){const e=document.getElementById("llmPrimer-copy-btn");if(e){const t=e.innerText;e.innerText="âœ“ Copied!",e.style.backgroundColor="#4caf50",e.style.color="white",setTimeout(()=>{e.innerText=t,e.style.backgroundColor="",e.style.color=""},2e3)}r("Markdown copied to clipboard!")}else r("Failed to copy to clipboard",!0),alert("Copy operation failed. This may be due to browser permissions.")}catch(e){console.error("Error in copyPrompt:",e),r("Error during copy operation",!0),alert("An error occurred: "+e.message)}var i,o}function i(){try{const e=document.getElementById("llmPrimer-panel");if(!e)throw new Error("Panel element not found");const t="dark"===e.getAttribute("data-theme");if(t){e.setAttribute("data-theme","light"),e.style.backgroundColor="#ffffff",e.style.color="#333333",e.style.border="1px solid #cccccc";e.querySelectorAll('button:not([id="llmPrimer-theme-btn"]):not([id="llmPrimer-toggle-btn"]):not([id="llmPrimer-close-btn"])').forEach(e=>{e.style.backgroundColor="#f0f0f0",e.style.color="#333333",e.style.border="1px solid #cccccc"}),e.querySelectorAll("select").forEach(e=>{e.style.backgroundColor="#ffffff",e.style.color="#333333",e.style.border="1px solid #cccccc"})}else{e.setAttribute("data-theme","dark"),e.style.backgroundColor="#333333",e.style.color="#ffffff",e.style.border="1px solid #555555";e.querySelectorAll('button:not([id="llmPrimer-theme-btn"]):not([id="llmPrimer-toggle-btn"]):not([id="llmPrimer-close-btn"])').forEach(e=>{e.style.backgroundColor="#444444",e.style.color="#ffffff",e.style.border="1px solid #666666"}),e.querySelectorAll("select").forEach(e=>{e.style.backgroundColor="#444444",e.style.color="#ffffff",e.style.border="1px solid #666666"})}localStorage.setItem("llmPrimer-theme",t?"light":"dark")}catch(e){console.error("Error toggling theme:",e)}}function r(){try{const e=document.getElementById("llmPrimer-panel");if(!e)throw new Error("Panel element not found");const t=localStorage.getItem("llmPrimer-theme")||"light";"dark"===t?(e.setAttribute("data-theme","dark"),e.style.backgroundColor="#333333",e.style.color="#ffffff",e.style.border="1px solid #555555",e.querySelectorAll('button:not([id="llmPrimer-theme-btn"]):not([id="llmPrimer-toggle-btn"]):not([id="llmPrimer-close-btn"])').forEach(e=>{e.style.backgroundColor="#444444",e.style.color="#ffffff",e.style.border="1px solid #666666"}),e.querySelectorAll("select").forEach(e=>{e.style.backgroundColor="#444444",e.style.color="#ffffff",e.style.border="1px solid #666666"})):(e.setAttribute("data-theme","light"),e.style.backgroundColor="#ffffff",e.style.color="#333333",e.style.border="1px solid #cccccc",e.querySelectorAll('button:not([id="llmPrimer-theme-btn"]):not([id="llmPrimer-toggle-btn"]):not([id="llmPrimer-close-btn"])').forEach(e=>{e.style.backgroundColor="#f0f0f0",e.style.color="#333333",e.style.border="1px solid #cccccc"}),e.querySelectorAll("select").forEach(e=>{e.style.backgroundColor="#ffffff",e.style.color="#333333",e.style.border="1px solid #cccccc"}))}catch(e){console.error("Error applying theme:",e)}}function c(){try{const e=document.getElementById("llmPrimer-panel");if(!e)throw new Error("Panel element not found");const t=Array.from(e.children).slice(1),n="true"===e.getAttribute("data-minimized");n?(t.forEach(e=>{e.style.display=""}),e.setAttribute("data-minimized","false")):(t.forEach(e=>{e.style.display="none"}),e.setAttribute("data-minimized","true"))}catch(e){console.error("Error toggling panel:",e)}}function d(){try{const e=document.getElementById("llmPrimer-panel");e&&e.remove()}catch(e){console.error("Error closing panel:",e)}}e().then(t).catch(e=>{console.error("Failed to load dependencies:",e),alert("Failed to load dependencies. Please check your network connection and try again.")})})();