(function(){if(document.getElementById('llmPrimer-panel')){const a=document.getElementById('llmPrimer-panel');a.style.display=a.style.display==='none'?'block':'none';return}const b=document.createElement('script');b.src='https://path-to-your-script/llmPrimer_bkm_kbLoader_v1.0.js';document.head.appendChild(b);b.onload=c;b.onerror=function(){alert('Failed to load knowledge base data. Please check your network connection and try again.')};function c(){try{const a=document.createElement('div');a.id='llmPrimer-panel';a.style.position='fixed';a.style.top='20px';a.style.right='20px';a.style.width='300px';a.style.backgroundColor='#ffffff';a.style.border='1px solid #cccccc';a.style.borderRadius='5px';a.style.padding='15px';a.style.boxShadow='0 4px 8px rgba(0, 0, 0, 0.1)';a.style.zIndex='10000';a.style.fontFamily='Arial, sans-serif';a.style.fontSize='14px';a.style.color='#333333';const b=document.createElement('div');b.style.display='flex';b.style.justifyContent='space-between';b.style.alignItems='center';b.style.marginBottom='15px';const c=document.createElement('h3');c.textContent='llmPrimer';c.style.margin='0';c.style.fontSize='16px';c.style.fontWeight='bold';b.appendChild(c);const d=document.createElement('div');d.style.display='flex';d.style.gap='5px';const e=document.createElement('button');e.id='llmPrimer-theme-btn';e.innerText='ðŸŒ“';e.title='Toggle theme';e.style.border='none';e.style.background='none';e.style.cursor='pointer';e.style.fontSize='16px';e.addEventListener('click',toggleTheme);d.appendChild(e);const f=document.createElement('button');f.id='llmPrimer-toggle-btn';f.innerText='âš¡';f.title='Toggle panel';f.style.border='none';f.style.background='none';f.style.cursor='pointer';f.style.fontSize='16px';f.addEventListener('click',minimizePanel);d.appendChild(f);const g=document.createElement('button');g.id='llmPrimer-close-btn';g.innerText='âœ•';g.title='Close panel';g.style.border='none';g.style.background='none';g.style.cursor='pointer';g.style.fontSize='16px';g.addEventListener('click',closePanel);d.appendChild(g);b.appendChild(d);a.appendChild(b);const h=document.createElement('label');h.textContent='Select Category:';h.style.display='block';h.style.marginBottom='5px';h.style.fontSize='14px';a.appendChild(h);const i=document.createElement('select');i.className='categorySelect';i.style.width='100%';i.style.padding='5px';i.style.marginBottom='15px';i.style.borderRadius='3px';i.style.border='1px solid #ccc';const j=document.createElement('option');j.value='';j.textContent='-- Select a category --';i.appendChild(j);if(typeof kbCategory==='undefined'||!Array.isArray(kbCategory)){throw new Error('Knowledge base categories not found or invalid')}kbCategory.forEach(a=>{const b=document.createElement('option');b.value=a.id;b.textContent=a.title;i.appendChild(b)});a.appendChild(i);const k=document.createElement('label');k.textContent='Select Knowledge Base:';k.style.display='block';k.style.marginBottom='5px';k.style.fontSize='14px';a.appendChild(k);const l=document.createElement('select');l.className='knowledgeBaseSelect';l.style.width='100%';l.style.padding='5px';l.style.marginBottom='15px';l.style.borderRadius='3px';l.style.border='1px solid #ccc';l.disabled=true;const m=document.createElement('option');m.value='';m.textContent='-- Select a knowledge base --';l.appendChild(m);a.appendChild(l);const n=document.createElement('div');n.style.display='flex';n.style.justifyContent='space-between';n.style.gap='10px';const o=document.createElement('button');o.id='llmPrimer-inject-btn';o.innerText='Inject Prompt';o.style.padding='8px 15px';o.style.borderRadius='3px';o.style.border='1px solid #ccc';o.style.backgroundColor='#f0f0f0';o.style.cursor='pointer';o.style.flex='1';o.disabled=true;o.addEventListener('click',injectPrompt);n.appendChild(o);const p=document.createElement('button');p.id='llmPrimer-copy-btn';p.innerText='Copy Prompt';p.style.padding='8px 15px';p.style.borderRadius='3px';p.style.border='1px solid #ccc';p.style.backgroundColor='#f0f0f0';p.style.cursor='pointer';p.style.flex='1';p.disabled=true;p.addEventListener('click',copyPrompt);n.appendChild(p);a.appendChild(n);document.body.appendChild(a);i.addEventListener('change',function(){populateKnowledgeBases(this.value);l.disabled=!this.value;o.disabled=true;p.disabled=true});l.addEventListener('change',function(){o.disabled=!this.value;p.disabled=!this.value});if(typeof kbDomain==='undefined'||!Array.isArray(kbDomain)){throw new Error('Knowledge base domains not found or invalid')}if(kbCategory.length>0){i.value=kbCategory[0].id;populateKnowledgeBases(kbCategory[0].id);l.disabled=false}applyCurrentTheme()}catch(a){console.error('Error initializing llmPrimer:',a);alert('Failed to initialize llmPrimer: '+a.message)}}function populateKnowledgeBases(a){try{const b=document.querySelector('.knowledgeBaseSelect');if(!b){throw new Error('Knowledge base select element not found')}while(b.options.length>1){b.remove(1)}const c=kbDomain.filter(b=>b.category===a);c.forEach(a=>{const c=document.createElement('option');c.value=a.id;c.textContent=a.title;b.appendChild(c)});if(c.length>0){b.value=c[0].id;const a=document.getElementById('llmPrimer-inject-btn');const d=document.getElementById('llmPrimer-copy-btn');if(a&&d){a.disabled=false;d.disabled=false}}}catch(a){console.error('Error populating knowledge bases:',a);alert('Failed to populate knowledge bases: '+a.message)}}function G(){try{const a=document.querySelector('.knowledgeBaseSelect');if(!a){throw new Error('Knowledge base select element not found')}const b=a.value;if(!b){return''}const c=kbDomain.find(a=>a.id===b);return c?c.docxUrl:''}catch(a){console.error('Error getting DOCX URL:',a);return''}}function R(){console.log('Prompt injected successfully')}function injectPrompt(){I()}function I(){try{const a=G();if(!a){alert('No valid DOCX URL found. Please select a knowledge base.');return}const b=document.querySelector("div#prompt-textarea p.placeholder");if(!b){alert("Target placeholder not found! Please ensure you're on a compatible LLM interface.");return}b.innerText=a;b.dispatchEvent(new Event("input",{bubbles:true}));setTimeout(()=>{const a=document.querySelector('button[data-testid="send-button"]');if(a){a.click();R()}else{alert("Send button not found! Prompt text was inserted but could not be sent automatically.")}},100)}catch(a){console.error('Error injecting prompt:',a);alert('Failed to inject prompt: '+a.message)}}function copyPrompt(){try{const a=G();if(!a){alert('No knowledge base selected!');return}if(navigator.clipboard&&navigator.clipboard.writeText){navigator.clipboard.writeText(a).then(()=>{const a=document.getElementById('llmPrimer-copy-btn');if(a){const b=a.innerText;a.innerText='âœ“ Copied!';setTimeout(()=>{a.innerText=b},2000)}else{alert('Knowledge base URL copied to clipboard!')}}).catch(a=>{console.error('Clipboard error:',a);alert('Failed to copy: '+a.message)})}else{const b=document.createElement('textarea');b.value=a;b.style.position='fixed';b.style.left='-999999px';b.style.top='-999999px';document.body.appendChild(b);b.focus();b.select();let c=false;try{c=document.execCommand('copy')}catch(a){console.error('Fallback clipboard error:',a)}document.body.removeChild(b);if(c){const b=document.getElementById('llmPrimer-copy-btn');if(b){const a=b.innerText;b.innerText='âœ“ Copied!';setTimeout(()=>{b.innerText=a},2000)}else{alert('Knowledge base URL copied to clipboard!')}}else{alert('Failed to copy. Please select and copy manually: '+a)}}}catch(a){console.error('Error copying to clipboard:',a);alert('Failed to copy: '+a.message)}}function toggleTheme(){try{const a=document.getElementById('llmPrimer-panel');if(!a){throw new Error('Panel element not found')}const b=a.getAttribute('data-theme')==='dark';if(b){a.setAttribute('data-theme','light');a.style.backgroundColor='#ffffff';a.style.color='#333333';a.style.border='1px solid #cccccc';const b=a.querySelectorAll('button:not([id="llmPrimer-theme-btn"]):not([id="llmPrimer-toggle-btn"]):not([id="llmPrimer-close-btn"])');b.forEach(a=>{a.style.backgroundColor='#f0f0f0';a.style.color='#333333';a.style.border='1px solid #cccccc'});const c=a.querySelectorAll('select');c.forEach(a=>{a.style.backgroundColor='#ffffff';a.style.color='#333333';a.style.border='1px solid #cccccc'})}else{a.setAttribute('data-theme','dark');a.style.backgroundColor='#333333';a.style.color='#ffffff';a.style.border='1px solid #555555';const b=a.querySelectorAll('button:not([id="llmPrimer-theme-btn"]):not([id="llmPrimer-toggle-btn"]):not([id="llmPrimer-close-btn"])');b.forEach(a=>{a.style.backgroundColor='#444444';a.style.color='#ffffff';a.style.border='1px solid #666666'});const c=a.querySelectorAll('select');c.forEach(a=>{a.style.backgroundColor='#444444';a.style.color='#ffffff';a.style.border='1px solid #666666'})}localStorage.setItem('llmPrimer-theme',b?'light':'dark')}catch(a){console.error('Error toggling theme:',a)}}function applyCurrentTheme(){try{const a=document.getElementById('llmPrimer-panel');if(!a){throw new Error('Panel element not found')}const b=localStorage.getItem('llmPrimer-theme')||'light';if(b==='dark'){a.setAttribute('data-theme','dark');a.style.backgroundColor='#333333';a.style.color='#ffffff';a.style.border='1px solid #555555';const b=a.querySelectorAll('button:not([id="llmPrimer-theme-btn"]):not([id="llmPrimer-toggle-btn"]):not([id="llmPrimer-close-btn"])');b.forEach(a=>{a.style.backgroundColor='#444444';a.style.color='#ffffff';a.style.border='1px solid #666666'});const c=a.querySelectorAll('select');c.forEach(a=>{a.style.backgroundColor='#444444';a.style.color='#ffffff';a.style.border='1px solid #666666'})}else{a.setAttribute('data-theme','light');a.style.backgroundColor='#ffffff';a.style.color='#333333';a.style.border='1px solid #cccccc';const b=a.querySelectorAll('button:not([id="llmPrimer-theme-btn"]):not([id="llmPrimer-toggle-btn"]):not([id="llmPrimer-close-btn"])');b.forEach(a=>{a.style.backgroundColor='#f0f0f0';a.style.color='#333333';a.style.border='1px solid #cccccc'});const c=a.querySelectorAll('select');c.forEach(a=>{a.style.backgroundColor='#ffffff';a.style.color='#333333';a.style.border='1px solid #cccccc'})}}catch(a){console.error('Error applying theme:',a)}}function minimizePanel(){try{const a=document.getElementById('llmPrimer-panel');if(!a){throw new Error('Panel element not found')}const b=Array.from(a.children).slice(1);const c=a.getAttribute('data-minimized')==='true';if(c){b.forEach(a=>{a.style.display=''});a.setAttribute('data-minimized','false')}else{b.forEach(a=>{a.style.display='none'});a.setAttribute('data-minimized','true')}}catch(a){console.error('Error toggling panel:',a)}}function closePanel(){try{const a=document.getElementById('llmPrimer-panel');if(a){a.remove()}}catch(a){console.error('Error closing panel:',a)}}})();