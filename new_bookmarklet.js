javascript:(function(){if(!window.KnowledgeBaseAdapter){const a=document.createElement("script");a.src="example_adapter.js",a.onload=b,document.head.appendChild(a)}else b();function b(){const a={default:"position:fixed;top:20px;right:20px;padding:15px;border-radius:5px;box-shadow:0 0 10px rgba(0,0,0,0.3);z-index:10000;width:300px;font-family:Arial,sans-serif;",fullHeight:"position:absolute;top:0;right:0;padding:15px;box-shadow:0 0 10px rgba(0,0,0,0.3);z-index:10000;width:300px;font-family:Arial,sans-serif;height:100vh;margin:0;"},b={light:{bg:"white",text:"#000",border:"#ccc"},dark:{bg:"#222",text:"#fff",border:"#444"}},c=window.KnowledgeBaseAdapter.getRegisteredBases();let d=null,e="default",f="light";const g=!0;function h(){if(!document.getElementById("kb-theme-styles")){const a=document.createElement("style");a.id="kb-theme-styles",a.textContent=".kb-light-theme{background-color:white!important;color:#000!important}.kb-light-theme select{background-color:white!important;color:#000!important;border-color:#ccc!important}.kb-dark-theme{background-color:#222!important;color:#fff!important}.kb-dark-theme select{background-color:#222!important;color:#fff!important;border-color:#444!important}#generate-btn{background-color:#49A74C!important;color:white!important}#copy-btn{background-color:#0B78D0!important;color:white!important}#close-btn,#style-toggle,#theme-toggle,#edit-kb-btn{background-color:transparent!important}",document.head.appendChild(a)}}const i=(a,b)=>{g&&(b==="error"?console.error(`[KB Generator] ${a}`):console.log(`[KB Generator] ${a}`))},j=window.KnowledgeBaseAdapter.registerBase,k=()=>{const a=document.getElementById("source-select").value;if(!a||!c[a])return;window.KnowledgeBaseAdapter.loadKnowledgeBase(a,b=>{if(b){d=window.KnowledgeBaseAdapter.getCurrentKB(),l();const b=document.getElementById("load-status");b&&(b.textContent=`Loaded: ${c[a].name}`,b.style.color="green")}else n(`Failed to load knowledge base: ${a}`)})},l=()=>{const a=document.getElementById("feature-select");if(a.innerHTML="",a.disabled=!1,!d?.features){i("Error: currentKB or currentKB.features is undefined","error"),a.innerHTML='<option value="">Error loading features</option>',a.disabled=!0,document.getElementById("generate-btn").disabled=!0,document.getElementById("copy-btn").disabled=!0;return}document.getElementById("generate-btn").disabled=!1,document.getElementById("copy-btn").disabled=!1;for(const b in d.features){const c=document.createElement("option");c.value=b,c.textContent=d.features[b].title,a.appendChild(c)}},m=()=>{if(!d?.generatePrompt)return"Error: Cannot generate prompt. The knowledge base doesn't provide a generator function.";return d.generatePrompt(document.getElementById("feature-select").value)},n=a=>{const b=document.getElementById("load-status");b&&(b.textContent=a,b.style.color="red"),document.getElementById("generate-btn").disabled=!0,document.getElementById("copy-btn").disabled=!0;const c=document.getElementById("feature-select");c.innerHTML='<option value="">Error loading data</option>',c.disabled=!0,alert(`Loading Error: ${a}\n\nPlease try again or check if the website allows loading external scripts.`)},o=()=>{const a=m(),b=document.querySelector("div#prompt-textarea p.placeholder");b?(b.innerText=a,b.dispatchEvent(new Event("input",{bubbles:!0})),setTimeout(()=>{const a=document.querySelector('button[data-testid="send-button"]');a&&a.click(),t()},100)):alert("Target placeholder not found!")},p=async()=>{const a=m();try{await navigator.clipboard.writeText(a);const b=document.getElementById("copy-btn"),c=b.innerText;b.innerText="Copied!",b.style.backgroundColor="#4CAF50",setTimeout(()=>{b.innerText=c,b.style.backgroundColor="#0B78D0"},1500)}catch(a){alert(`Copy failed: ${a}`)}},q=()=>{const a=document.getElementById("kb-edit-container");"none"===a.style.display?(a.style.display="block",document.getElementById("edit-kb-btn").textContent="Done",r()):(a.style.display="none",document.getElementById("edit-kb-btn").textContent="Edit")},r=()=>{const a=window.KnowledgeBaseAdapter.getRegisteredBases(),b=document.getElementById("kb-list");b.innerHTML="",Object.entries(a).forEach(([c,{name:d,url:e,global:f}])=>{const g=document.createElement("div");g.style.cssText="display:flex;justify-content:space-between;margin-bottom:10px;padding:8px;border:1px solid #ccc;border-radius:4px",g.innerHTML=`<div><div style="font-weight:bold">${d}</div><div style="font-size:12px;color:#777;word-break:break-all">${e}</div><div style="font-size:12px;color:#777">ID: ${c}, Global: ${f}</div></div><div style="display:flex;flex-direction:column;gap:5px"><button class="kb-edit-btn" data-id="${c}" style="padding:3px 8px;background:#0B78D0;color:white;border:none;border-radius:3px;cursor:pointer">Edit</button><button class="kb-delete-btn" data-id="${c}" style="padding:3px 8px;background:#D32F2F;color:white;border:none;border-radius:3px;cursor:pointer">Delete</button></div>`,b.appendChild(g)}),document.querySelectorAll(".kb-edit-btn").forEach(b=>{b.addEventListener("click",b=>{const c=b.target.getAttribute("data-id"),d=a[c];document.getElementById("kb-edit-id").value=c,document.getElementById("kb-edit-name").value=d.name,document.getElementById("kb-edit-url").value=d.url,document.getElementById("kb-edit-global").value=d.global,document.getElementById("kb-edit-form").style.display="block",document.getElementById("kb-list").style.display="none"})}),document.querySelectorAll(".kb-delete-btn").forEach(b=>{b.addEventListener("click",b=>{const c=b.target.getAttribute("data-id");if(confirm(`Are you sure you want to delete "${a[c].name}"?`)){window.KnowledgeBaseAdapter.deleteKnowledgeBase(c);const a=document.getElementById("source-select"),b=a.querySelector(`option[value="${c}"]`);b&&b.remove(),r()}})})},s=()=>{const a=document.getElementById("kb-edit-id").value.trim(),b=document.getElementById("kb-edit-name").value.trim(),c=document.getElementById("kb-edit-url").value.trim(),d=document.getElementById("kb-edit-global").value.trim();if(!a||!b||!c||!d){alert("All fields are required");return}window.KnowledgeBaseAdapter.registerBase(a,b,c,d),document.getElementById("kb-edit-form").style.display="none",document.getElementById("kb-list").style.display="block",r()},t=()=>{document.body.removeChild(v),document.removeEventListener("keydown",u)},u=a=>{a.key==="Escape"&&t()};h();const v=document.createElement("div");window.KnowledgeBaseLoader={registerBase:window.KnowledgeBaseAdapter.registerBase},v.id="kb-prompt-generator",v.style.cssText=a.default,v.className="kb-light-theme",v.innerHTML='<h2 style="color:#147CBD;margin:28px 0 10px 0;font-size:1.2em">Prompt Generator</h2><div style="display:flex;justify-content:end;position:absolute;top:12px;float:right;right:30px;"><button id="edit-kb-btn" style="margin:0px 3px;background-color:transparent;border-radius:3px;padding:3px;cursor:pointer" title="Edit Knowledge Bases" aria-label="Edit Knowledge Bases">Edit</button><button id="style-toggle" style="margin:0px 3px;background-color:transparent;border-radius:3px;padding:3px;cursor:pointer" title="Toggle Panel Style" aria-label="Toggle Panel Style"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line></svg></button><button id="theme-toggle" style="background-color:transparent;border-radius:3px;padding:3px;cursor:pointer" title="Toggle Theme" aria-label="Toggle Theme"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></button></div><div id="load-status" style="margin-bottom:10px;padding:5px;background:#f0f0f0;border-radius:3px;font-size:12px;color:orange;">Ready to load data...</div><div id="kb-edit-container" style="display:none;margin-bottom:15px"><div id="kb-list" style="max-height:200px;overflow-y:auto"></div><div id="kb-edit-form" style="display:none"><h3 style="margin:10px 0;font-size:14px">Edit Knowledge Base</h3><input id="kb-edit-id" type="text" placeholder="Unique ID" style="width:100%;padding:5px;margin-bottom:5px;border-radius:3px;border:1px solid #ccc"><input id="kb-edit-name" type="text" placeholder="Display Name" style="width:100%;padding:5px;margin-bottom:5px;border-radius:3px;border:1px solid #ccc"><input id="kb-edit-url" type="text" placeholder="URL" style="width:100%;padding:5px;margin-bottom:5px;border-radius:3px;border:1px solid #ccc"><input id="kb-edit-global" type="text" placeholder="Global Variable" style="width:100%;padding:5px;margin-bottom:10px;border-radius:3px;border:1px solid #ccc"><div style="display:flex;gap:5px"><button id="kb-save-btn" style="flex:1;padding:5px;background:#49A74C;color:white;border:none;border-radius:3px;cursor:pointer">Save</button><button id="kb-cancel-btn" style="flex:1;padding:5px;background:#777;color:white;border:none;border-radius:3px;cursor:pointer">Cancel</button></div></div><div style="margin-top:10px;text-align:center"><button id="kb-add-btn" style="padding:5px 10px;background:#0B78D0;color:white;border:none;border-radius:3px;cursor:pointer">Add New Knowledge Base</button></div></div><label style="display:block;margin-bottom:5px;font-size:14px">Select knowledge base:</label><select id="source-select" style="width:100%;padding:5px;margin-bottom:15px;border-radius:3px;border:1px solid #ccc"></select><label style="display:block;margin-bottom:5px;font-size:14px">Select feature:</label><select id="feature-select" style="width:100%;padding:5px;margin-bottom:15px;border-radius:3px;border:1px solid #ccc"></select><div style="display:flex;gap:10px;margin-bottom:10px"><button id="generate-btn" style="flex:1;padding:8px;background:#49A74C;color:white;border:none;border-radius:3px;cursor:pointer;font-weight:bold">Inject Prompt</button><button id="copy-btn" style="flex:1;padding:8px;background:#0B78D0;color:white;border:none;border-radius:3px;cursor:pointer;font-weight:bold">Copy Prompt</button></div><button id="close-btn" aria-label="close prompt generator" style="position:absolute;top:10px;right:10px;background-color:transparent;border:none;cursor:pointer;font-size:16px;font-weight:bold">✕</button>',document.body.appendChild(v),document.getElementById("close-btn").addEventListener("click",t),document.getElementById("generate-btn").addEventListener("click",o),document.getElementById("copy-btn").addEventListener("click",p),document.getElementById("source-select").addEventListener("change",k),document.getElementById("edit-kb-btn").addEventListener("click",q),document.getElementById("kb-add-btn").addEventListener("click",()=>{document.getElementById("kb-edit-id").value="",document.getElementById("kb-edit-name").value="",document.getElementById("kb-edit-url").value="",document.getElementById("kb-edit-global").value="",document.getElementById("kb-edit-form").style.display="block",document.getElementById("kb-list").style.display="none"}),document.getElementById("kb-save-btn").addEventListener("click",s),document.getElementById("kb-cancel-btn").addEventListener("click",()=>{document.getElementById("kb-edit-form").style.display="none",document.getElementById("kb-list").style.display="block"}),document.addEventListener("keydown",u),document.getElementById("generate-btn").disabled=!0,document.getElementById("copy-btn").disabled=!0,document.getElementById("style-toggle").addEventListener("click",function(){if(e==="default"){e="fullHeight",this.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="9" y1="3" x2="9" y2="21"></line></svg>',this.title="Switch to Floating Panel"}else{e="default",this.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line></svg>',this.title="Switch to Full Height Sidebar"}const b=v.className;v.style.cssText=a[e],v.className=b}),document.getElementById("theme-toggle").addEventListener("click",function(){if(f==="light"){f="dark",this.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>',this.title="Switch to Light Theme",v.className="kb-dark-theme"}else{f="light",this.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>',this.title="Switch to Light Theme",v.className="kb-light-theme"}});const w=window.KnowledgeBaseAdapter.getRegisteredBases();for(const a in w){const b=w[a];j(a,b.name,b.url,b.global)}k()}})()