(function(){window.KnowledgeBaseRegistry={features:{},loadedCategories:{},registerFeature:function(a,b){return this.features[a]||(this.features[a]={}),this.features[a][b.metadata.id]=b,console.log(`Registered feature: ${b.metadata.title} [${a}/${b.metadata.id}]`),window[`kb${a}${b.metadata.id}`]=b,this},getFeature:function(a,b){return this.features[a]&&this.features[a][b]?this.features[a][b]:null},getCategoryFeatures:function(a){return this.features[a]||{}},loadFeature:function(a,b,c){const d=`features/${a}/${b}.js`;console.log(`Loading feature: ${d}`);const e=document.createElement("script");e.src=d,e.onload=function(){console.log(`Loaded feature module: ${d}`);const e=window.KnowledgeBaseRegistry.getFeature(a,b);c&&"function"==typeof c&&c(e)},e.onerror=function(){console.error(`Failed to load feature module: ${d}`),c&&"function"==typeof c&&c(null)},document.head.appendChild(e)},loadCategory:function(a,b){if(this.loadedCategories[a])return b&&b(this.getCategoryFeatures(a)),void console.log(`Using cached category: ${a}`);const c=`categories/${a}/${a}-kb-core.js`;console.log(`Loading category: ${c}`);const d=document.createElement("script");d.src=c,d.onload=function(){console.log(`Loaded category: ${c}`),window.KnowledgeBaseRegistry.loadedCategories[a]=!0,b&&"function"==typeof b&&b(window.KnowledgeBaseRegistry.getCategoryFeatures(a))},d.onerror=function(){console.error(`Failed to load category: ${c}`),b&&"function"==typeof b&&b(null)},document.head.appendChild(d)},generatePrompt:function(a,b,c={}){const d=this.getFeature(a,b);return d?d.generateFeaturePrompt(c):`Error: Feature ${a}/${b} not found`},initialize:function(a){if(console.log("Initializing Knowledge Base Registry"),a&&a.autoloadCategories){const b=a.autoloadCategories;Array.isArray(b)&&b.forEach(a=>{this.loadCategory(a)})}return this}},console.log("Knowledge Base Registry initialized");const a=new Event("kbRegistryReady");document.dispatchEvent(a)})();